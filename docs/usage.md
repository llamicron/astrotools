---
layout: page
title: Usage and Examples
---

This is an overview of the API exposed by `astrotools`. It's main purpose is to take some parameters, like a path to an input file, a vartools command, etc, then run vartools with those parameters. It will return the output of vartools and the data files that vartools creates.

Vartools works with very large files, and creates very large files. As such, the file data will not be sent through the web API. Instead, an absolute path to a file will be the input.

## Using the Interface
Currently the interface doesn't exist in version `0.1.0`. It will be responsible for creating a vartools command for you and handling input and output. Come back later...

## Using the API
*Note: This example is for version `0.1.0`. The API may change in the future.*

Currently (v 0.1.0) this application does not have a web interface (will be added soon). This is an example of just the API to run vartools and reformat data.

To start, boot up the API server with `cargo run` or execute the binary executable. You should see:
```
~/code/astrotools(dev âœ—) cargo run
   Compiling astrotools v0.1.0 (/Users/llamicron/code/astrotools)
    Finished dev [unoptimized + debuginfo] target(s) in 4.34s
     Running `target/debug/astrotools`
ðŸ”§ Configured for development.
    => address: localhost
    => port: 8000
    => log: normal
    => workers: 8
    => secret key: generated
    => limits: forms = 32KiB
    => keep-alive: 5s
    => tls: disabled
ðŸ›°  Mounting /:
    => POST /vartools application/json (handle_json)
ðŸ‘¾ Catchers:
    => 404
ðŸš€ Rocket has launched from http://localhost:8000
```

Before sending a post request to the server in order to run vartools, we need some data. All you need is a single data file in the format described in the [`DataFormatter`](https://llamicron.github.io/astrotools/data_formatter/) docs. Put the file somewhere accessible. For example, I have `october.dat` at `/Users/llamicron/Desktop/october.dat`. Grab the full, absolute path to that data file.

Once you have your data and the path to it, send a `POST` request to the API at the `/vartools` route. Here's the payload to send:
```json
{
  "cmd": "vartools command goes here",
  "infile": "/Users/llamicron/Desktop/october.dat"
}
```

The vartools command to send could be quite long. Here's an example:
```
vartools -l /Users/llamicron/Desktop/october/formatted_input/lc_list -ascii -oneline -BLS q 0.01 0.1 0.1 1.5 100000 200 -6 3 1 /Users/llamicron/Desktop/october/vartools 1 /Users/llamicron/Desktop/october/vartools 0 fittrap nobinnedrms ophcurve /Users/llamicron/Desktop/october/vartools -0.1 1.1 0.001
```

The `DataFormatter` will create some directories where your data file is. All files generated by this program or vartools will be contained in a directory with the same name as the file (excluding the executable). Because my file was at `~/Desktop/october.dat`, the output directory will be `~/Desktop/october/`. In there, `vartools/` and `formatted_input/` will be created and filled with some files. All vartools files are in `vartools/`, and all files generated by this program are in `formatted_input/`.

If the vartools command runs without errors, the API will return this payload:
```json
{
  "status": "ok",
  "vartools": "Vartools stdout here"
}
```
If the vartools command fails, it will return
```json
{
  "status": "error",
  "vartools": "Vartools stderr here"
}
```
